<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>After Effects Powerplay - Vol 2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0b0d12;
            --panel: #121622;
            --panel-2: #0f1320;
            --muted: #8a93a5;
            --text: #e7ecf3;
            --accent: #8b5cf6;
            --accent-2: #22d3ee;
            --ok: #22c55e;
            --danger: #ef4444;
            --warn: #f59e0b;
            --ring: rgba(139, 92, 246, .35);
            --shadow: 0 10px 30px rgba(0, 0, 0, .35), 0 2px 6px rgba(0, 0, 0, .25);
            --radius: 18px;
            --card-pad: 14px;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            color: var(--text);
            background: #0b0d12;
            overflow-x: hidden;
            position: relative;
            isolation: isolate
        }

        body::before {
            content: "";
            position: fixed;
            inset: -10% -10%;
            background: linear-gradient(120deg, #0b0d12, #121622, #0f1320);
            background-size: 400% 400%;
            animation: moveGradient 18s ease-in-out infinite;
            filter: blur(22px) saturate(120%);
            opacity: .9;
            z-index: -2;
            pointer-events: none
        }

        body::after {
            content: "";
            position: fixed;
            inset: 0;
            background:
                radial-gradient(60% 40% at 15% 0%, rgba(139, 92, 246, .22), transparent 60%),
                radial-gradient(50% 35% at 85% 100%, rgba(34, 211, 238, .18), transparent 60%),
                radial-gradient(35% 30% at 70% 20%, rgba(16, 185, 129, .14), transparent 60%);
            mix-blend-mode: overlay;
            opacity: .9;
            z-index: -1;
            pointer-events: none
        }

        @keyframes moveGradient {
            0% {
                background-position: 0% 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0% 50%
            }
        }

        header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: saturate(140%) blur(8px);
            -webkit-backdrop-filter: saturate(140%) blur(8px);
            background: linear-gradient(180deg, rgba(11, 13, 18, .78), rgba(11, 13, 18, .48));
            border-bottom: 1px solid rgba(255, 255, 255, .06)
        }

        .wrap {
            max-width: 1240px;
            margin: 0 auto;
            padding: 20px
        }

        .header-inner {
            max-width: 1240px;
            margin: 0 auto;
            padding: 14px 20px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: center
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center
        }

        .brand .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            box-shadow: 0 0 0 6px rgba(139, 92, 246, .12)
        }

        h1 {
            margin: 0;
            font-size: clamp(18px, 3vw, 24px);
            font-weight: 800
        }

        .subtitle {
            color: var(--muted)
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center
        }

        .chip-btn,
        .input,
        .select {
            appearance: none;
            border: 1px solid rgba(255, 255, 255, .08);
            background: var(--panel);
            color: var(--text);
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer
        }

        .input {
            cursor: text
        }

        .badge {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: .5px;
            color: #dcd7fe;
            background: rgba(139, 92, 246, .18);
            border: 1px solid rgba(139, 92, 246, .35);
            padding: 6px 10px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .titlebar {
            display: flex;
            gap: 10px;
            align-items: baseline;
            margin: 24px 0 12px
        }

        .titlebar h2 {
            margin: 0;
            font-size: clamp(26px, 4vw, 36px)
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px
        }

        @media (max-width:1000px) {
            .grid {
                grid-template-columns: repeat(2, 1fr)
            }
        }

        @media (max-width:640px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: linear-gradient(180deg, var(--panel-2), var(--panel));
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 320px
        }

        .card-head {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 10px;
            align-items: center;
            padding: 12px 14px;
            border-bottom: 1px solid rgba(255, 255, 255, .06)
        }

        .card .day {
            display: flex;
            gap: 10px;
            align-items: center;
            font-weight: 800
        }

        .card .cal {
            width: 18px;
            height: 18px;
            border-radius: 6px;
            display: inline-grid;
            place-items: center;
            background: linear-gradient(180deg, var(--accent), #6d28d9)
        }

        .card .cal svg {
            width: 12px;
            height: 12px
        }

        .meta {
            color: var(--muted);
            font-size: 13px
        }

        .card .form {
            padding: 0 var(--card-pad) var(--card-pad);
            display: flex;
            flex-direction: column;
            flex: 1
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin: 8px 0
        }

        .field label {
            font-weight: 600;
            font-size: 13px
        }

        .field input,
        .field textarea {
            background: var(--panel);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 10px;
            padding: 10px;
            color: var(--text);
            font-size: 14px
        }

        .field textarea {
            min-height: 72px;
            resize: vertical
        }

        .field input:focus,
        .field textarea:focus {
            border-color: transparent;
            box-shadow: 0 0 0 3px var(--ring);
            outline: none
        }

        .submit-btn {
            width: 100%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            background: #166534;
            border: 1px solid rgba(34, 197, 94, .45);
            padding: 10px 12px;
            border-radius: 10px;
            color: #d1fae5;
            font-weight: 800;
            cursor: pointer;
            margin: 8px 0 10px
        }

        .submit-btn:hover {
            filter: brightness(1.06)
        }

        .toast {
            position: fixed;
            right: 18px;
            bottom: 18px;
            background: rgba(17, 24, 39, .95);
            border: 1px solid rgba(255, 255, 255, .08);
            padding: 12px 14px;
            border-radius: 12px;
            display: none
        }

        .toast.show {
            display: block
        }

        .pager {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 18px 0
        }

        .pager button {
            background: #1f2536;
            border: 1px solid rgba(255, 255, 255, .12);
            padding: 8px 12px;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer
        }

        .pager button[disabled] {
            opacity: .6;
            cursor: not-allowed
        }

        .pager .meta {
            color: var(--muted)
        }

        .locked {
            opacity: .45
        }

        .locked input,
        .locked textarea,
        .locked button {
            pointer-events: none
        }

        footer {
            margin-top: 28px
        }

        .progress-card {
            background: linear-gradient(180deg, var(--panel-2), var(--panel));
            border: 1px solid rgba(139, 92, 246, .35);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 16px
        }

        .progress-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px
        }

        .progress-wrap {
            position: relative;
            background: rgba(255, 255, 255, .06);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 999px;
            height: 14px;
            overflow: hidden
        }

        .progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            transition: width .4s ease
        }

        .progress-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            color: #cbd5e1;
            font-size: 14px
        }

        .progress-badge {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: .4px;
            color: #22d3ee;
            background: rgba(34, 211, 238, .15);
            border: 1px solid rgba(34, 211, 238, .35);
            padding: 6px 10px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .card.completed {
            border-color: rgba(34, 197, 94, .25);
            box-shadow: 0 0 0 1px rgba(34, 197, 94, .18) inset, 0 0 0 3px rgba(34, 197, 94, .14), var(--shadow);
            background: radial-gradient(900px 180px at 18% -10%, rgba(34, 197, 94, .08), transparent 60%), linear-gradient(180deg, var(--panel-2), var(--panel))
        }

        .status-chip {
            display: inline-flex;
            gap: 6px;
            align-items: center;
            font-size: 12px;
            font-weight: 800;
            letter-spacing: .4px;
            color: #bbf7d0;
            background: rgba(34, 197, 94, .14);
            border: 1px solid rgba(34, 197, 94, .3);
            padding: 6px 10px;
            border-radius: 999px;
            text-transform: uppercase
        }

        .status-chip svg {
            width: 14px;
            height: 14px;
            opacity: .95
        }

        .card.leave {
            border-color: rgba(239, 68, 68, .35);
            box-shadow: 0 0 0 1px rgba(239, 68, 68, .22) inset, 0 0 0 3px rgba(239, 68, 68, .28), 0 10px 30px rgba(0, 0, 0, .35), 0 0 32px rgba(239, 68, 68, .35);
            background: radial-gradient(900px 180px at 18% -10%, rgba(239, 68, 68, .10), transparent 60%), linear-gradient(180deg, var(--panel-2), var(--panel))
        }

        .status-chip.leave {
            color: #fee2e2;
            background: rgba(239, 68, 68, .16);
            border-color: rgba(239, 68, 68, .35)
        }

        .card.leave .form {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 180px;
            padding: 24px 0
        }

        .leave-message {
            color: var(--danger);
            font-weight: 800;
            text-align: center;
            font-size: 14px
        }

        .action-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 20px 29px 0px;
            padding: 0 var(--card-pad)
        }

        .link-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(180deg, #171c2b, #121826);
            border: 1px solid rgba(255, 255, 255, .12);
            color: #fff;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 700;
            font-size: 14px;
            transition: transform .08s ease, filter .15s ease, box-shadow .15s ease
        }

        .link-btn svg {
            width: 16px;
            height: 16px;
            opacity: .9
        }

        .link-btn:hover {
            filter: brightness(1.08)
        }

        .link-btn:active {
            transform: translateY(1px)
        }

        .link-btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, .35)
        }

        .subtle {
            color: #9aa5b4;
            font-size: 12px;
            margin: 0 0 12px;
            padding: 0 var(--card-pad)
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, .55);
            z-index: 60;
            backdrop-filter: blur(4px) saturate(120%)
        }

        .modal-backdrop.show {
            display: flex
        }

        .modal {
            width: min(520px, 92vw);
            background: linear-gradient(180deg, var(--panel-2), var(--panel));
            border: 1px solid rgba(139, 92, 246, .35);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 18px
        }

        .modal-head {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px
        }

        .modal-head .cal {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: inline-grid;
            place-items: center;
            background: linear-gradient(180deg, var(--accent), #6d28d9)
        }

        .modal-title {
            font-size: clamp(18px, 3vw, 20px);
            font-weight: 800;
            margin: 0
        }

        .modal-body {
            color: var(--muted);
            margin: 8px 0 14px;
            line-height: 1.5
        }

        .modal-date {
            color: var(--text);
            font-weight: 700
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end
        }

        .btn {
            appearance: none;
            background: #1f2536;
            border: 1px solid rgba(255, 255, 255, .12);
            color: #fff;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            font: inherit
        }

        .btn.ok {
            background: #166534;
            border-color: rgba(34, 197, 94, .45);
            color: #d1fae5;
            font-weight: 800
        }

        .btn.warn {
            background: #7c3e06;
            border-color: rgba(245, 158, 11, .55);
            color: #fde68a;
            font-weight: 800
        }

        .btn:hover {
            filter: brightness(1.06)
        }

        .dp-wrap {
            position: relative
        }

        .dp-input {
            cursor: pointer
        }

        .dp-panel {
            position: absolute;
            top: 110%;
            left: 0;
            z-index: 70;
            width: 280px;
            background: linear-gradient(180deg, var(--panel-2), var(--panel));
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 14px;
            box-shadow: var(--shadow);
            padding: 10px;
            display: none
        }

        .dp-panel.show {
            display: block
        }

        .dp-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 6px 10px
        }

        .dp-title {
            font-weight: 800;
            letter-spacing: .2px
        }

        .dp-nav {
            display: flex;
            gap: 6px
        }

        .dp-nav button,
        .dp-link {
            appearance: none;
            background: #1f2536;
            border: 1px solid rgba(255, 255, 255, .12);
            color: #fff;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            font: inherit
        }

        .dp-nav button:hover,
        .dp-link:hover {
            filter: brightness(1.06)
        }

        .dp-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px
        }

        .dp-cell {
            text-align: center;
            padding: 8px 0;
            border-radius: 8px
        }

        .dp-dow {
            color: #8a93a5;
            font-size: 12px;
            font-weight: 700
        }

        .dp-day {
            cursor: pointer;
            background: #111627;
            border: 1px solid rgba(255, 255, 255, .06)
        }

        .dp-day:hover {
            filter: brightness(1.06)
        }

        .dp-day.out {
            opacity: .45
        }

        .dp-day.today {
            outline: 2px solid rgba(139, 92, 246, .45)
        }

        .dp-day.selected {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #07111a;
            font-weight: 800;
            border-color: transparent
        }

        .note-block {
            padding: 6px var(--card-pad) 12px
        }

        .note-title {
            font-weight: 800;
            letter-spacing: .2px;
            margin: 10px 0 6px;
            color: #d1d7e2;
            font-size: 13px
        }

        .note-text {
            margin: 0;
            color: #cbd5e1;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            text-align: justify
        }

        .footer-bar {
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, .08);
            padding: 10px 12px;
            text-align: center;
            color: #9aa5b4;
            font-size: 13px
        }

        /* Account chip */
        .account {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(180deg, #171c2b, #121826);
            border: 1px solid rgba(255, 255, 255, .12);
            padding: 8px 12px;
            border-radius: 999px
        }

        .account .avatar {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: grid;
            place-items: center;
            color: #0b0d12;
            font-weight: 800;
            font-size: 11px;
            line-height: 1
        }

        .account .avatar.has-image {
            background-size: cover;
            background-position: center;
            color: transparent
        }

        .account-name {
            font-size: 13px;
            color: #d1d7e2
        }
    </style>
</head>

<body>
    <header>
        <div class="header-inner">
            <div class="brand">
                <div class="dot" aria-hidden="true"></div>
                <div>
                    <h1>After Effects Powerplay - Vol 2.0</h1>
                    <div class="subtitle">45 Days Editing Challenge</div>
                </div>
            </div>

            <div class="controls">
                <label for="startDate" class="subtitle">Progress start date</label>
                <div class="dp-wrap">
                    <input id="startDate" class="input dp-input" type="text" inputmode="none" placeholder="YYYY-MM-DD"
                        aria-label="Progress start date" readonly />
                    <div id="dp" class="dp-panel" role="dialog" aria-modal="true" aria-label="Choose a date">
                        <div class="dp-head">
                            <button class="dp-link" data-delta="-12" type="button" title="Prev year">«</button>
                            <div class="dp-nav">
                                <button class="dp-prev" type="button" title="Prev month">‹</button>
                                <div class="dp-title"></div>
                                <button class="dp-next" type="button" title="Next month">›</button>
                            </div>
                            <button class="dp-link" data-delta="12" type="button" title="Next year">»</button>
                        </div>
                        <div class="dp-grid dp-dows"></div>
                        <div class="dp-grid dp-days"></div>
                        <div class="dp-foot">
                            <button class="dp-link dp-clear" type="button">Clear</button>
                            <button class="dp-link dp-today" type="button">Today</button>
                        </div>
                    </div>
                </div>

                <input id="search" class="input" type="search" placeholder="Search days or date" aria-label="Search" />
                <button id="leaveBtn" class="chip-btn" type="button" aria-pressed="false"
                    title="Mark today as leave">Take Leave (3 left)</button>

                <!-- Account chip + links -->
                <span class="account" id="accountChip" title="Signed in">
                    <span class="avatar" id="accountAvatar" aria-hidden="true"></span>
                    <span class="account-name" id="accountName">...</span>
                </span>
                <a href="./auth/profile.html" class="chip-btn">Profile</a>
                <button id="logoutBtn" class="chip-btn" type="button" title="Log out">Log out</button>
            </div>
        </div>
    </header>

    <div class="wrap">
        <div class="titlebar">
            <h2>Daily Forms</h2>
            <span id="countBadge" class="badge">0 visible</span>
        </div>

        <div id="grid" class="grid" aria-live="polite"></div>
        <div id="pager" class="pager"></div>

        <div id="toast" class="toast" role="status" aria-live="polite">Saved</div>

        <footer>
            <div class="progress-card" aria-label="Challenge progress">
                <div class="progress-head">
                    <div class="subtitle">Only today's card is writable. Past and future cards stay dimmed and locked.
                        You can take up to 3 leave days without affecting progress.</div>
                    <span id="progressBadge" class="progress-badge">0 of 45</span>
                </div>
                <div class="progress-wrap" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
                    aria-label="Overall progress">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="progress-meta">
                    <span id="progressText">0% complete</span>
                    <span id="progressDates" class="meta"></span>
                </div>
            </div>
        </footer>
    </div>

    <template id="day-card">
        <section class="card">
            <div class="card-head">
                <div class="day">
                    <span class="cal" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M7 2v3M17 2v3M4 9h16M5 5h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z"
                                stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                                opacity=".9" />
                        </svg>
                    </span>
                    <span class="day-text"></span>
                </div>
                <div class="meta date-text"></div>
            </div>
            <form class="form" novalidate>
                <div class="field"><label>Video URL</label><input name="video" type="text"
                        placeholder="https://youtube.com/... or youtu.be/..." /></div>
                <div class="field"><label>Project File URL</label><input name="project" type="text"
                        placeholder="https://drive.google.com/... or docs.google.com/..." /></div>
                <div class="field"><label>Something you learned new!</label><textarea name="note"
                        placeholder="Share what you learned today..."></textarea></div>
                <button class="submit-btn" type="submit">Submit</button>
            </form>
        </section>
    </template>

    <!-- Confirm modal -->
    <div id="confirmModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
        <div class="modal">
            <div class="modal-head">
                <span class="cal" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" width="18" height="18" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M7 2v3M17 2v3M4 9h16M5 5h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z"
                            stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                            opacity=".9" />
                    </svg>
                </span>
                <h3 id="confirmTitle" class="modal-title">Confirm start date</h3>
            </div>
            <div class="modal-body">Is this your challenge start date: <span id="confirmDateText"
                    class="modal-date"></span>? Once confirmed, you cannot change it.</div>
            <div class="modal-actions">
                <button id="cancelConfirm" class="btn" type="button" aria-label="Cancel">Cancel</button>
                <button id="okConfirm" class="btn ok" type="button">OK, lock it</button>
            </div>
        </div>
    </div>

    <!-- Leave modal -->
    <div id="leaveModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="leaveTitle">
        <div class="modal">
            <div class="modal-head">
                <span class="cal" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" width="18" height="18" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M7 2v3M17 2v3M4 9h16M5 5h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z"
                            stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                            opacity=".9" />
                    </svg>
                </span>
                <h3 id="leaveTitle" class="modal-title">Take leave today</h3>
            </div>
            <div class="modal-body">Mark <span id="leaveDayText" class="modal-date"></span> as a leave day? You can take
                up to 3 leave days without affecting progress.</div>
            <div class="modal-actions">
                <button id="cancelLeave" class="btn" type="button">Cancel</button>
                <button id="okLeave" class="btn warn" type="button">Yes, take leave</button>
            </div>
        </div>
    </div>

    <!-- Success modal -->
    <div id="successModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="successTitle">
        <div class="modal">
            <div class="modal-head">
                <span class="cal" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" width="18" height="18" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M7 2v3M17 2v3M4 9h16M5 5h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z"
                            stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                            opacity=".9" />
                    </svg>
                </span>
                <h3 id="successTitle" class="modal-title">Nice work!</h3>
            </div>
            <div class="modal-body" style="text-align:center">
                <img id="successGif" src="" alt="Celebration" style="max-width:100%;border-radius:12px" />
                <p class="meta" style="margin-top:10px">Entry saved for today.</p>
            </div>
            <div class="modal-actions" style="justify-content:center">
                <button id="successOk" class="btn ok" type="button">Back to cards</button>
            </div>
        </div>
    </div>

    <!-- Auth helper -->
    <script src="auth/auth.js"></script>

    <script>
        // Guard page
        AEPP_AUTH.ensureAuth();

        // Account chip init using currentUser
        (function accountInit() {
            const u = AEPP_AUTH.currentUser();
            const email = u?.email || "";
            const baseName = (u?.name && u.name.trim()) || (email ? email.split('@')[0] : 'User');

            const nameEl = document.getElementById('accountName');
            const avatarEl = document.getElementById('accountAvatar');

            nameEl.textContent = email ? `${baseName} · ${email}` : baseName;

            if (u?.avatar) {
                avatarEl.style.backgroundImage = `url("${u.avatar}")`;
                avatarEl.classList.add('has-image');
                avatarEl.textContent = "";
            } else {
                const init = baseName.trim().split(/\s+/).slice(0, 2).map(s => s[0]?.toUpperCase() || '').join('');
                avatarEl.textContent = init || 'U';
                avatarEl.classList.remove('has-image');
                avatarEl.style.backgroundImage = '';
            }

            document.getElementById('logoutBtn').addEventListener('click', AEPP_AUTH.signOut);
        })();
    </script>

    <!-- App logic -->
    <script>
        const TOTAL_DAYS = 45;
        const STORAGE_KEY = 'aepp-entries-v4';
        const START_KEY = 'aepp-start-date-v1';
        const LEAVE_KEY = 'aepp-leaves-v1';
        const LEAVE_CAP = 3;

        (function () {
            const qs = new URLSearchParams(location.search);
            if (qs.get('reset') === '1') {
                try {
                    localStorage.removeItem(START_KEY);
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(LEAVE_KEY);
                } finally {
                    location.replace(location.pathname + location.search.replace(/\?reset=1/, '') + location.hash);
                }
            }
        })();

        let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        let startDateStr = localStorage.getItem(START_KEY) || '';
        let leaves = JSON.parse(localStorage.getItem(LEAVE_KEY) || '[]');
        let currentPage = 1;

        const grid = document.getElementById('grid');
        const pager = document.getElementById('pager');
        const tpl = document.getElementById('day-card');
        const badge = document.getElementById('countBadge');
        const search = document.getElementById('search');
        const toast = document.getElementById('toast');

        const startDateInput = document.getElementById('startDate');
        const dp = document.getElementById('dp');
        const dpTitle = dp.querySelector('.dp-title');
        const dpPrev = dp.querySelector('.dp-prev');
        const dpNext = dp.querySelector('.dp-next');
        const dpDows = dp.querySelector('.dp-dows');
        const dpDays = dp.querySelector('.dp-days');
        const dpToday = dp.querySelector('.dp-today');
        const dpClear = dp.querySelector('.dp-clear');

        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressBadge = document.getElementById('progressBadge');
        const progressDates = document.getElementById('progressDates');

        const leaveBtn = document.getElementById('leaveBtn');
        const leaveModal = document.getElementById('leaveModal');
        const leaveDayText = document.getElementById('leaveDayText');
        const okLeave = document.getElementById('okLeave');
        const cancelLeave = document.getElementById('cancelLeave');

        const successModal = document.getElementById('successModal');
        const successOk = document.getElementById('successOk');
        const successGifEl = document.getElementById('successGif');

        const GIFS = [
            "https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3Nxbm1jdTA5OWRlZDhiMWl4NTF3aXE5bng4bGFza3dwbXd4NG5jZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/YRuFixSNWFVcXaxpmX/giphy.gif",
            "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3MDZuY2w2aWhtY3NjODRtaXZxMGM1OTJkb3dubnRzYmx1MzZycjJvMCZlcD12MV9naWZzX3JlbGF0ZWQmY3Q9Zw/vcKEsYOdjoCeJRpn95/giphy.gif",
        ];
        let lastGifIndex = -1;
        function pickGif() { if (GIFS.length === 1) return GIFS[0]; let i; do { i = Math.floor(Math.random() * GIFS.length); } while (i === lastGifIndex); lastGifIndex = i; return GIFS[i]; }
        function openSuccessModal() {
            successGifEl.src = pickGif();
            function cleanup() { successOk.removeEventListener('click', close); successModal.removeEventListener('click', backdrop); document.removeEventListener('keydown', esc); }
            function close() { cleanup(); successModal.classList.remove('show'); }
            function backdrop(e) { if (e.target === successModal) close(); }
            function esc(e) { if (e.key === 'Escape') close(); }
            successOk.addEventListener('click', close);
            successModal.addEventListener('click', backdrop);
            document.addEventListener('keydown', esc);
            successModal.classList.add('show');
            setTimeout(() => successOk.focus(), 0);
        }

        if (startDateStr) { startDateInput.value = startDateStr; startDateInput.toggleAttribute('disabled', true); }

        const fmt = d => new Intl.DateTimeFormat(undefined, { day: '2-digit', month: 'short', year: 'numeric' }).format(d);
        function toISODate(d) { const y = d.getFullYear(); const m = String(d.getMonth() + 1).padStart(2, '0'); const da = String(d.getDate()).padStart(2, '0'); return `${y}-${m}-${da}`; }
        function parseStart() { return startDateStr ? new Date(startDateStr + 'T00:00:00') : null; }
        function dayToDate(day) { const s = parseStart(); if (!s) return ''; const d = new Date(s); d.setDate(s.getDate() + (day - 1)); return fmt(d); }
        function todayIndex() { const s = parseStart(); if (!s) return null; const now = new Date(); const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()); const diff = Math.floor((midnight - s) / 86400000); return diff + 1; }

        function showToast(msg) { toast.textContent = msg; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 1400); }
        function saveLeaves() { localStorage.setItem(LEAVE_KEY, JSON.stringify(leaves)); }
        function leavesUsed() { return Math.min(leaves.length, LEAVE_CAP); }
        function leavesLeft() { return Math.max(0, LEAVE_CAP - leavesUsed()); }
        function updateLeaveBtn() { leaveBtn.textContent = `Take Leave (${leavesLeft()} left)`; leaveBtn.setAttribute('aria-pressed', 'false'); }

        function updateProgress() {
            const completedWork = Object.keys(entries).length;
            const creditedLeaves = leavesUsed();
            const pct = Math.min(100, Math.round(((completedWork + creditedLeaves) / TOTAL_DAYS) * 100));
            progressFill.style.width = pct + '%';
            progressText.textContent = pct + '% complete';
            progressBadge.textContent = (completedWork + creditedLeaves) + ' of ' + TOTAL_DAYS;
            const s = parseStart();
            if (s) {
                const start = fmt(s); const end = dayToDate(TOTAL_DAYS);
                progressDates.textContent = 'Start: ' + start + '  |  End: ' + end + '  |  Leaves used: ' + creditedLeaves + '/' + LEAVE_CAP;
            } else {
                progressDates.textContent = 'Set a start date to track your calendar window';
            }
            document.querySelector('.progress-wrap').setAttribute('aria-valuenow', String(pct));
            updateLeaveBtn();
        }

        function render() {
            const term = (search.value || '').toLowerCase();
            const filtered = Array.from({ length: TOTAL_DAYS }, (_, i) => i + 1).filter(day => {
                const e = entries[day] || {}; const isLeave = leaves.includes(day);
                const prettyDate = (dayToDate(day) || '').toLowerCase();
                const isoDate = (function () { const s = parseStart(); if (!s) return ''; const d = new Date(s); d.setDate(s.getDate() + (day - 1)); return toISODate(d); })().toLowerCase();
                const text = [e.note || '', e.video || '', e.project || '', isLeave ? 'leave' : '', `day ${day}`, prettyDate, isoDate].join(' ').toLowerCase();
                return term ? text.includes(term) : true;
            });

            const pageSize = 9; const total = filtered.length; const totalPages = Math.max(1, Math.ceil(total / pageSize));
            if (currentPage > totalPages) currentPage = totalPages; if (currentPage < 1) currentPage = 1;
            const start = (currentPage - 1) * pageSize; const page = filtered.slice(start, start + pageSize);

            grid.innerHTML = ''; page.forEach(day => grid.appendChild(buildCard(day)));
            const from = total ? start + 1 : 0; const to = start + page.length;
            badge.textContent = `Showing ${from} to ${to} of ${total}`;
            renderPager(totalPages);
            updateProgress();
        }

        function renderPager(totalPages) {
            pager.innerHTML = '';
            const prev = btn('Prev', () => { currentPage--; render(); }, currentPage <= 1);
            const next = btn('Next', () => { currentPage++; render(); }, currentPage >= totalPages);
            const meta = document.createElement('span'); meta.className = 'meta'; meta.textContent = `Page ${currentPage} of ${totalPages}`;
            pager.append(prev, meta, next);
        }
        function btn(text, onClick, disabled) { const b = document.createElement('button'); b.textContent = text; b.disabled = !!disabled; b.addEventListener('click', onClick); return b; }

        function normalizeUrl(input) {
            if (!input) return null; let u = input.trim(); if (!u) return null; if (!/^https?:\/\//i.test(u)) u = 'https://' + u;
            try { const url = new URL(u); if (!url.hostname || !/\.\w{2,}$/.test(url.hostname)) return null; return url.href; } catch { return null; }
        }
        function isYouTubeUrl(input) {
            const u = normalizeUrl(input); if (!u) return false;
            try { const url = new URL(u); const host = url.hostname.toLowerCase(); return host === 'youtu.be' || host.endsWith('youtube.com'); } catch { return false; }
        }
        function isGoogleDriveUrl(input) {
            const u = normalizeUrl(input); if (!u) return false;
            try {
                const url = new URL(u); const host = url.hostname.toLowerCase();
                if (host !== 'drive.google.com' && host !== 'docs.google.com') return false;
                const p = url.pathname.toLowerCase();
                const looksLikeFolder = p.startsWith('/drive/folders/') || /\/folders\/[a-z0-9_-]+$/i.test(p);
                const looksLikeOpenId = p === '/open' && url.searchParams.has('id');
                const looksLikeFileOrEditor = p.startsWith('/file/') || p.startsWith('/uc') || p.startsWith('/document/') || p.startsWith('/spreadsheets/') || p.startsWith('/presentation/');
                return looksLikeFolder || looksLikeOpenId || looksLikeFileOrEditor;
            } catch { return false; }
        }

        function iconSvg(name) {
            if (name === 'video') return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 10.5V7a2 2 0 0 0-2-2H6A2 2 0 0 0 4 7v10a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-3.5l4 3V7.5l-4 3Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
            if (name === 'file') return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7l-5-5Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 2v5h5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
            if (name === 'check') return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
            if (name === 'pause') return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 4h2v16h-2zM16 4h2v16h-2z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
            return '';
        }

        function makeLinkButton(label, url, icon) {
            const a = document.createElement('a');
            a.className = 'link-btn'; a.href = url; a.target = '_blank'; a.rel = 'noopener noreferrer';
            a.setAttribute('role', 'button'); a.setAttribute('aria-label', label);
            a.innerHTML = iconSvg(icon) + `<span>${label}</span>`;
            return a;
        }

        function applyCompletionUI(node, saved) {
            node.classList.add('completed');
            const head = node.querySelector('.card-head');
            if (!head.querySelector('.status-chip')) {
                const chip = document.createElement('span'); chip.className = 'status-chip'; chip.innerHTML = iconSvg('check') + '<span>Completed</span>'; head.appendChild(chip);
            }
            const form = node.querySelector('.form'); form.innerHTML = '';
            const actions = document.createElement('div'); actions.className = 'action-row';
            const v = saved.video ? normalizeUrl(saved.video) : null;
            const p = saved.project ? normalizeUrl(saved.project) : null;
            if (v) actions.appendChild(makeLinkButton('View Video', v, 'video'));
            if (p) actions.appendChild(makeLinkButton('View Project', p, 'file'));
            if (actions.children.length) form.append(actions);
            if (saved.note) {
                const wrap = document.createElement('div'); wrap.className = 'note-block';
                const t = document.createElement('div'); t.className = 'note-title'; t.textContent = 'Something you learned new!';
                const n = document.createElement('p'); n.className = 'note-text'; n.textContent = saved.note;
                wrap.append(t, n);
                form.append(wrap);
            }
            const when = saved.savedAt ? new Date(saved.savedAt) : null;
            const footer = document.createElement('div'); footer.className = 'footer-bar'; footer.textContent = when ? 'Submitted on ' + fmt(when) : 'Submitted';
            form.append(footer);
        }

        function applyLeaveUI(node) {
            node.classList.add('leave');
            const head = node.querySelector('.card-head');
            if (!head.querySelector('.status-chip.leave')) {
                const chip = document.createElement('span'); chip.className = 'status-chip leave'; chip.innerHTML = iconSvg('pause') + '<span>Leave</span>';
                head.appendChild(chip);
            }
            const form = node.querySelector('.form'); form.innerHTML = '';
            const info = document.createElement('div'); info.className = 'leave-message'; info.textContent = 'Leave taken for this day.';
            form.append(info);
        }

        function buildCard(day) {
            const node = tpl.content.firstElementChild.cloneNode(true);
            node.querySelector('.day-text').textContent = `Day ${day}`;
            node.querySelector('.date-text').textContent = dayToDate(day) || 'Set start date';

            const form = node.querySelector('.form');
            const saved = entries[day] || {};
            form.video.value = saved.video || '';
            form.project.value = saved.project || '';
            form.note.value = saved.note || '';

            const todayIdx = todayIndex();
            const isToday = todayIdx === day;
            const alreadySaved = !!entries[day];
            const isLeave = leaves.includes(day);
            const canWrite = startDateStr && isToday && !alreadySaved && !isLeave;

            if (isLeave) { applyLeaveUI(node); return node; }
            if (alreadySaved) { applyCompletionUI(node, saved); return node; }

            if (!canWrite) {
                node.classList.add('locked');
                Array.from(form.elements).forEach(el => el.disabled = true);
            }

            form.addEventListener('submit', e => {
                e.preventDefault();
                if (!canWrite) return;

                const rawVideo = form.video.value.trim();
                const rawProject = form.project.value.trim();
                const note = form.note.value.trim();

                if (rawVideo && !isYouTubeUrl(rawVideo)) { showToast('Video must be a valid YouTube link'); return; }
                if (rawProject && !isGoogleDriveUrl(rawProject)) { showToast('Project must be a valid Google Drive file or folder link'); return; }

                const video = rawVideo ? normalizeUrl(rawVideo) : null;
                const project = rawProject ? normalizeUrl(rawProject) : null;

                if ((video && !project) || (!video && project)) { showToast('Provide both YouTube and Google Drive links or write a note'); return; }
                if (!video && !project && !note) { showToast('Add both links or a note before submitting'); return; }

                const payload = { savedAt: Date.now() };
                if (video) payload.video = video;
                if (project) payload.project = project;
                if (note) payload.note = note;

                entries[day] = payload;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));

                openSuccessModal();
                render();
            });

            return node;
        }

        const DOWS = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];
        DOWS.forEach(d => { const el = document.createElement('div'); el.className = 'dp-cell dp-dow'; el.textContent = d; dpDows.appendChild(el); });
        let view = (function () { const today = new Date(); return { y: today.getFullYear(), m: today.getMonth() }; })();

        function buildMonth(y, m, selectedISO) {
            dpTitle.textContent = new Date(y, m, 1).toLocaleString(undefined, { month: 'long', year: 'numeric' });
            dpDays.innerHTML = '';
            const first = new Date(y, m, 1);
            const startDay = first.getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();
            const prevDays = new Date(y, m, 0).getDate();
            for (let i = 0; i < startDay; i++) { const d = prevDays - startDay + 1 + i; dpDays.appendChild(dayCell(new Date(y, m - 1, d), true, selectedISO)); }
            for (let d = 1; d <= daysInMonth; d++) { dpDays.appendChild(dayCell(new Date(y, m, d), false, selectedISO)); }
            const totalCells = dpDays.children.length;
            for (let i = 1; totalCells + i <= 42; i++) { dpDays.appendChild(dayCell(new Date(y, m + 1, i), true, selectedISO)); }
        }
        function dayCell(date, isOut, selectedISO) {
            const el = document.createElement('div');
            el.className = 'dp-cell dp-day' + (isOut ? ' out' : '');
            el.textContent = date.getDate();
            const iso = toISODate(date);
            const todayIso = toISODate(new Date());
            if (iso === todayIso) el.classList.add('today');
            if (iso === selectedISO) el.classList.add('selected');
            el.addEventListener('click', () => { selectDate(date); });
            return el;
        }

        function openPicker() {
            if (startDateInput.disabled) return;
            dp.classList.add('show'); dp.style.left = '0'; dp.style.top = '110%';
            const selectedISO = startDateInput.value || '';
            buildMonth(view.y, view.m, selectedISO);
            document.addEventListener('click', outsideHandler);
            document.addEventListener('keydown', escClose);
        }
        function closePicker() { dp.classList.remove('show'); document.removeEventListener('click', outsideHandler); document.removeEventListener('keydown', escClose); }
        function outsideHandler(e) { if (!dp.contains(e.target) && e.target !== startDateInput) { closePicker(); } }
        function escClose(e) { if (e.key === 'Escape') { closePicker(); } }

        function openConfirmModal(selectedISO, onConfirm, onCancel) {
            const modal = document.getElementById('confirmModal');
            const okBtn = document.getElementById('okConfirm');
            const cancelBtn = document.getElementById('cancelConfirm');
            const dateEl = document.getElementById('confirmDateText');
            dateEl.textContent = selectedISO;
            function cleanup() { okBtn.removeEventListener('click', okHandler); cancelBtn.removeEventListener('click', cancelHandler); modal.removeEventListener('click', backdropHandler); document.removeEventListener('keydown', escHandler); }
            function okHandler() { cleanup(); modal.classList.remove('show'); onConfirm && onConfirm(); }
            function cancelHandler() { cleanup(); modal.classList.remove('show'); onCancel && onCancel(); }
            function backdropHandler(e) { if (e.target === modal) cancelHandler(); }
            function escHandler(e) { if (e.key === 'Escape') cancelHandler(); }
            okBtn.addEventListener('click', okHandler);
            cancelBtn.addEventListener('click', cancelHandler);
            modal.addEventListener('click', backdropHandler);
            document.addEventListener('keydown', escHandler);
            modal.classList.add('show');
            setTimeout(() => okBtn.focus(), 0);
        }

        function selectDate(date) {
            const iso = toISODate(date);
            startDateInput.value = iso;
            closePicker();
            openConfirmModal(
                iso,
                () => { startDateStr = iso; localStorage.setItem(START_KEY, startDateStr); startDateInput.disabled = true; showToast('Start date set'); render(); },
                () => { startDateInput.value = startDateStr || ''; }
            );
        }

        dpPrev.addEventListener('click', () => { const d = new Date(view.y, view.m - 1, 1); view.y = d.getFullYear(); view.m = d.getMonth(); buildMonth(view.y, view.m, startDateInput.value || ''); });
        dpNext.addEventListener('click', () => { const d = new Date(view.y, view.m + 1, 1); view.y = d.getFullYear(); view.m = d.getMonth(); buildMonth(view.y, view.m, startDateInput.value || ''); });
        dp.querySelectorAll('.dp-link[data-delta]').forEach(btn => {
            btn.addEventListener('click', () => {
                const delta = parseInt(btn.getAttribute('data-delta'), 10);
                const d = new Date(view.y, view.m + delta, 1);
                view = { y: d.getFullYear(), m: d.getMonth() };
                buildMonth(view.y, view.m, startDateInput.value || '');
            });
        });
        dpToday.addEventListener('click', () => { const now = new Date(); view = { y: now.getFullYear(), m: now.getMonth() }; buildMonth(view.y, view.m, startDateInput.value || ''); });
        dpClear.addEventListener('click', () => { if (startDateInput.disabled) return; startDateInput.value = ''; buildMonth(view.y, view.m, ''); });
        startDateInput.addEventListener('click', openPicker);
        startDateInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openPicker(); } });

        function openLeaveModal(day) {
            const modal = leaveModal;
            leaveDayText.textContent = dayToDate(day) || `Day ${day}`;
            function cleanup() { okLeave.removeEventListener('click', okHandler); cancelLeave.removeEventListener('click', cancelHandler); modal.removeEventListener('click', backdrop); document.removeEventListener('keydown', escHandler); }
            function okHandler() { cleanup(); modal.classList.remove('show'); performLeave(day); }
            function cancelHandler() { cleanup(); modal.classList.remove('show'); }
            function backdrop(e) { if (e.target === modal) cancelHandler(); }
            function escHandler(e) { if (e.key === 'Escape') cancelHandler(); }
            okLeave.addEventListener('click', okHandler);
            cancelLeave.addEventListener('click', cancelHandler);
            modal.addEventListener('click', backdrop);
            document.addEventListener('keydown', escHandler);
            modal.classList.add('show');
            setTimeout(() => okLeave.focus(), 0);
        }

        function performLeave(day) {
            if (leaves.includes(day)) { showToast('Today is already marked as leave'); return; }
            if (Object.prototype.hasOwnProperty.call(entries, day)) { showToast('Already submitted today'); return; }
            if (leaves.length >= LEAVE_CAP) { showToast('Leave limit reached'); return; }
            leaves.push(day);
            saveLeaves();
            showToast('Leave taken');
            render();
        }

        leaveBtn.addEventListener('click', () => {
            if (!startDateStr) { showToast('Set start date first'); return; }
            const day = todayIndex();
            if (day == null || day < 1 || day > TOTAL_DAYS) { showToast('Out of challenge window'); return; }
            if (leaves.length >= LEAVE_CAP) { showToast('You have used all leave days'); return; }
            openLeaveModal(day);
        });

        function updateLeaveBtnAndProgress() { updateLeaveBtn(); updateProgress(); }

        search.addEventListener('input', render);
        (function init() { render(); })();
    </script>
</body>

</html>